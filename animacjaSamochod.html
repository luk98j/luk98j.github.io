<!DOCTYPE html>
<html lang="en">
    <head>
    </head>
    <body>
        <canvas id="road-rectangle" width="800" height="600" style="border:1px solid #000000; background-color: green;">
        </canvas>

        <script type="text/javascript">
            var canvas = document.getElementById("road-rectangle");
            var ctx = canvas.getContext("2d");
            var widthOfGrass = canvas.width;
            var heightOfGrass = canvas.height;
            var rectangleWidth = 35;
            var rectangleHeight = 35;
            var apexWidth=30;
            var xCordinateRoad = 225;
            var xCordinate = (canvas.width/2);
            var yCorindate = canvas.height-rectangleHeight;
            var roadArray = []; // divide road to ten
            var roadSizePx = 270;
            var onePieceRoadH = 60;
            var howOftenChangeRoad = 10;
            var lastY;
            var whiteLine;
            var roadChanges = 1;
            window.addEventListener("keydown", moveSomething, false);
            var firstInit = true;
            setInterval(initRoad,300)
            
            function initRoad(){
                if(firstInit){
                    initDrawRoad();
                    firstInit = false;
                } else {
                    drawRoad();
                }
                drawCar()
            }

            function drawRoad(){
                
                var random = randomIntFromInterval(0,5)
                var changeSize = randomIntFromInterval(8,30)
                console.log(random)
                if(roadArray.length == 10){
                    for(var i = 0;i<roadArray.length;i++){
                        if(i==0){
                            roadArray[i].delete()
                            roadArray.splice(i,1)
                        }
                        if(roadChanges%howOftenChangeRoad==0){
                            if(random%2==0){
                                
                                roadArray[i].delete()
                                if(roadArray[i-1]!=undefined){
                                    roadArray[i].updateWithShiftPlus(changeSize*i,roadArray[i-1].x)
                                } else {
                                    roadArray[i].updateWithShiftPlus(changeSize*i,roadArray[i].x)
                                }
                                roadArray[i].draw() 
                            } else {
                                roadArray[i].delete()
                                if(roadArray[i-1]!=undefined){
                                    roadArray[i].updateWithShiftMinus(changeSize*i,roadArray[i-1].x)
                                } else {
                                    roadArray[i].updateWithShiftMinus(changeSize*i,roadArray[i].x)
                                }
                                
                                roadArray[i].draw() 
                            }
                        } else {
                            roadArray[i].delete()
                            roadArray[i].update()
                            roadArray[i].draw() 
                        }
                        
                    }
                    lastY = roadArray[roadArray.length-1].y;
                    lastX = roadArray[roadArray.length-1].x;
                    whiteLine = roadArray[roadArray.length-1].whiteLine;
                    var y = lastY - onePieceRoadH;
                    var x = lastX
                    var road = new Road(lastX,y,roadSizePx,onePieceRoadH,!whiteLine);
                    road.draw()
                    roadArray.push(road);
                } 
                roadChanges++;
            }

            function moveSomething(e) {
                //ctx.clearRect(xCordinate, yCorindate, rectangleWidth, rectangleHeight);
                switch(e.keyCode) {
                    case 37:
                        // left key pressed
                        if(xCordinate !=0){
                            xCordinate -= 5;
                        } else {
                            drawCar();
                        }
                        break;
                    case 39:
                        // right key pressed
                        if(xCordinate != canvas.width-75){
                            xCordinate += 5;
                        } else{
                            drawCar();
                        }
                        break;
                }   
                drawCar();
            }

            
            function randomIntFromInterval(min, max) { // min and max included 
                return Math.floor(Math.random() * (max - min + 1) + min)
            }
            function drawCar(){
                var car = new Car(xCordinate, yCorindate, rectangleWidth, rectangleHeight)
                car.update()
                car.delete()
                car.draw()
            }

            function initDrawRoad(){
                for(var i=1;i<=10;i++){
                        var y = canvas.height - onePieceRoadH * i;
                        var road;
                    if(i%2==0){
                        road = new Road(xCordinateRoad,y,roadSizePx,onePieceRoadH,true);
                    } else {
                        road = new Road(xCordinateRoad,y,roadSizePx,onePieceRoadH,false);
                    }
                    road.draw()
                    roadArray.push(road);
                }
            }
            function Road(x,y,width,height,whiteLine){
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.whiteLine = whiteLine
            }

            Road.prototype = {
                draw: function() {
                    if(this.whiteLine){
                        ctx.beginPath();
                        ctx.fillStyle = 'gray'
                        ctx.fillRect(this.x,this.y,this.width,this.height);
                        ctx.fillStyle = "red"
                        ctx.fillRect(this.x-apexWidth,this.y,apexWidth,this.height);
                        ctx.fillRect(this.x+this.width,this.y,apexWidth,this.height);
                        ctx.fillStyle = "white"
                        ctx.fillRect(this.x+this.width/2,this.y,apexWidth-15,this.height);
                        ctx.stroke();
                    } else {
                        ctx.beginPath();
                        ctx.fillStyle = 'gray'
                        ctx.fillRect(this.x,this.y,this.width,this.height);
                        ctx.fillStyle = "white"
                        ctx.fillRect(this.x-apexWidth,this.y,apexWidth,this.height);
                        ctx.fillRect(this.x+this.width,this.y,apexWidth,this.height);
                        ctx.stroke();
                    }
                   
                },
                update: function() {
                    this.y = this.y + this.height;
                },
                updateWithShiftPlus: function(variable,diffrentX){
                    this.y = this.y + this.height;
                    if(this.x + variable <= canvas.width){
                        this.x = this.x + variable;
                    } else{
                        this.x = diffrentX
                    }
                    
                },
                updateWithShiftMinus: function(variable, diffrentX){
                    this.y = this.y + this.height;
                    if(this.x - variable > apexWidth){
                        this.x = this.x - variable;
                    } else{
                        this.x = diffrentX
                    }
                },
                delete: function(){
                    ctx.clearRect(this.x-apexWidth,this.y,this.width+apexWidth+apexWidth,this.height)
                },
            }


            function Car(x, y, width, height) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }

            Car.prototype = {
                draw: function() {
                    ctx.beginPath();
                    ctx.fillStyle = 'red'
                    ctx.fillRect(this.x,this.y,this.width,this.height);
                    ctx.stroke();
                },
                update: function() {
                    this.x = xCordinate;
                },
                delete: function(){
                    ctx.clearRect(this.x,this.y,this.width,this.height)
                },
            };

        </script>
    </body>
</html>